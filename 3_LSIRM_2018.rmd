---
title: "Introduction To R - LSIRM 2018 3"
author: "Simon Kiss"
date: '2018-07-04'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=F, message=F, include=F, results='hide')

```
# Data Management

This is a good moment to introduce you to some basic data and code management principles that will hopefully make your life much easier.  The basic idea is to break up your code into manageable chunks and save each chunk in a separate script. 

```{r hidden-purl-script, results='hide', echo=F}
purl('LSIRM_2_2018.Rmd', '2_LSIRM_2018.R')

```

By using the command `source()` you can execute R scripts linearly.  What this means is that you can put some parts of your workflow in separate (i.e. more manageable chunks) and then source them in the next file. This has the added advantage of making analyses that you've done once before, executable for other projects when you need code you've written now. 

In practice, what I usually do is end up having at least three separate working scripts. The first reads the data in and conducts any recodes, the second that conducts some analyses, and the third that does some gussying up producing nice looking plots and tables. In the second file, I source the first file, and in the third file, I source the first and second .R files and play with the plots. If I discover I need to change something (say, I need to change a variable to a dichotomous variable), then I can go back and either change the initial recode or add another one. 

#### Assignment 1
>1. Try sourcing in the file from yesterday.
```{r read-in}
```


### Tidy data
`ggplot()` really starts to sing, however, when we combine it with some of the newest innovations in R, namely the`dplyr` and the `tidyr`package.  To introduce these, it is crucial to understand the difference between long and wide data.  

In long (tidy) data, each column is one variable and each row is one observation.   Currently our data is a mix of long and wide data.  

```{r, show-long-data}
ces
```

### Gathering filter, selecting
The tidyverse is meant to accomplish a few things. One of these things is to improve the readability of R code. Base R can be quite messy. 

One of the key innovations in the `tidyverse()` is the use of this character `%>%`. This is a pipe that sends the results of one command to the command on the next line. Technically, this character only works when the `magritr` library is loaded, but this is always loaded automatically when you run `library(tidyverse)` so you almost never have to worry about it.  

Another big issue is consistency. The `tidyverse()` is built ona consistent set of design principles that make it easier to use. 

For example, the base R way to select a few variables is to use the `subset()` command with the `select` argument: 

```{r show-subset-select}
subset(ces, select=c('gender', 'ideology'))
```
The same command is used to subset *cases* , not just variables.

```{r, results='markup'}
#This selects only males
subset(ces, select='gender',gender=='M')
```

By contrast the tidyverse uses two separate commands for these two different functions: `filter()` and `select()`


```{r, tidyverse-filter, results='markup'}
filter(ces, gender=='M')
```

```{r, tidyverse-select, results='markup'}
select(ces, c(gender, ideology))
```

Note, within the tidyverse, *all* functions take a data.frame as the first argument, and other arguments following. 

Or, to *really* improve readability you can use the pipe to feed data frames to the next line.  The keyboard shortcut for inserting the pipe is `%>%` is `shift-CMD-M`  on macs. 


```{r tidyverse-filter-men}
#Filter CES to include only men
ces %>% 
  filter(gender=='M')
```
Then, add another command to select only ideology
```{r filter-men-select-ideology}
ces %>% 
  filter(gender=='M') %>% 
  select(gender, ideology) 
```

Now, we can even feed that into ggplot2 to draw a histogram of men's ideology scores. Note that because we are feeding the data frame line-by-line to the next function, there is no need to name the data frame in the ggplot2 command, we can just substitute it with a `.`

```{r}

#Start with a data frame
ces %>% 
  #Filter out men
  filter(gender=='M') %>% 
  #select the variable you want
  select(ideology) %>% 
  #Do something you want
  ggplot(., aes(x=ideology))+geom_bar()
```


```{r calculate-group-means}
#Take dataframe
ces %>% 
  #name the groups
  group_by(gender) %>% 
  #wE are going to summarize each group with a function
  summarize(
    mean(ideology, na.rm=T)
  )
```

In theory these chains can be infinite. In reality you usually. 

### Long v. Wide Data
Central to the tidyverse's select is the notion of tidy data.  

#### Assignment 11
> 1. Create a subset of the ces data 
```{r}
```
